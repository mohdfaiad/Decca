/* Extract Database deccant:d:\decca\iectdata\iectdata.gdb */
CREATE DATABASE "deccant:d:\decca\iectdata\iectdata.gdb" PAGE_SIZE 1024 
;


/* Table: JOB, Owner: SYSDBA */
CREATE TABLE JOB (JOB_NO CHAR(7) NOT NULL,
        DESCRIPTION VARCHAR(30) CHARACTER SET BIG_5,
        QUOT_NO CHAR(7),
        KEYWORD VARCHAR(20),
PRIMARY KEY (JOB_NO));

/* Table: SUB_JOB, Owner: SYSDBA */
CREATE TABLE SUB_JOB (JOB_NO CHAR(7) NOT NULL,
        LINE_NO INTEGER NOT NULL,
        QTY NUMERIC(9, 3) DEFAULT 0
,
        JLENGTH NUMERIC(9, 3) DEFAULT 0
,
        JWIDTH NUMERIC(9, 3) DEFAULT 0
,
        JHEIGHT NUMERIC(9, 3) DEFAULT 0
,
        LAST_UPD_DATE DATE,
        STATUS CHAR(1) DEFAULT "W"
,
        AUTHORIED_BY VARCHAR(10),
        COMMENT BLOB SUB_TYPE 0 SEGMENT SIZE 80,
        SUB_JOB_CAT CHAR(4),
        PHOTO BLOB SUB_TYPE 0 SEGMENT SIZE 80,
        DESCRIPTION VARCHAR(60) CHARACTER SET BIG_5,
        SUB_JOB_NO VARCHAR(30),
        QUOT_LINE_NO VARCHAR(60),
        UNIT CHAR(5) CHARACTER SET BIG_5,
        CREATED_BY CHAR(4) CHARACTER SET BIG_5,
PRIMARY KEY (JOB_NO, LINE_NO));

/* Table: SUB_JOB_COST, Owner: SYSDBA */
CREATE TABLE SUB_JOB_COST (JOB_NO CHAR(7) NOT NULL,
        LINE_NO INTEGER NOT NULL,
        COST_CAT CHAR(7) NOT NULL,
        BUDGET_QTY NUMERIC(9, 3) DEFAULT 0
,
        BUDGET_AMT NUMERIC(9, 2) DEFAULT 0
,
        ACTUAL_QTY NUMERIC(9, 3) DEFAULT 0
,
        ACTUAL_AMT NUMERIC(9, 2) DEFAULT 0
,
        STD_QTY NUMERIC(9, 3) DEFAULT 0
,
        STD_AMOUNT NUMERIC(9, 2) DEFAULT 0
,
        SECTION_NO CHAR(1) DEFAULT "0"
,
        QUOT_ITEM_NO CHAR(7),
        QTY_UNIT CHAR(10) CHARACTER SET BIG_5,
        DESCRIPTION CHAR(15) CHARACTER SET BIG_5,
        CATEGORY CHAR(7),
PRIMARY KEY (JOB_NO, LINE_NO, COST_CAT));


SET TERM ^ ;

/* Triggers only will work for SQL triggers */
CREATE TRIGGER SUB_JOB_DELETE FOR SUB_JOB                         
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM SUB_JOB_COST
    WHERE JOB_NO = OLD.JOB_NO
      AND LINE_NO = OLD.LINE_NO;
END
 ^
CREATE TRIGGER JOB_DELETE FOR JOB                             
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM SUB_JOB
    WHERE JOB_NO = OLD.JOB_NO;
  delete from sub_job_cost
    where job_no = old.job_no;
END
 ^
COMMIT WORK ^
SET TERM ; ^

/* Grant permissions for this database */
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON JOB TO PUBLIC;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON SUB_JOB TO PUBLIC;
GRANT DELETE, INSERT, SELECT, UPDATE, REFERENCES ON SUB_JOB_COST TO PUBLIC;

